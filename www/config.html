<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8" />
    <title>系统配置</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div class="navbar">
        <div>报警系统</div>
        <div>
            <a href="index.html">首页</a>
            <a href="config.html" class="active">配置</a>
            <a href="/logout">退出</a>

        </div>
    </div>
    <div class="container">
        <h2>配置参数</h2>
        <form id="config-form">
            <label>监听端口:
                <input type="number" name="port" required />
            </label>
            <label>监听路径:
                <input type="text" name="path" required />
            </label>
            <label>推送地址:
                <input type="text" name="targetUrl" required />
            </label>
            <button type="submit">保存并重启服务</button>
        </form>
        <div id="status"></div>
    </div>

    <script>
        fetch("/get-config")
            .then(res => res.json())
            .then(config => {
                const form = document.forms["config-form"];
                form.port.value = config.port;
                form.path.value = config.path;
                form.targetUrl.value = config.targetUrl;
            });

        document.getElementById("config-form").addEventListener("submit", e => {
            e.preventDefault();
            const formData = new FormData(e.target);
            fetch("/update-config-restart", {
                method: "POST",
                body: new URLSearchParams(formData)
            })
                .then(res => res.text())
                .then(msg => {
                    document.getElementById("status").textContent = "✅ 配置已更新并重启服务";
                });
        });
    </script>
</body>

</html>