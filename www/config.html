<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8" />
    <title>系统配置</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div class="navbar">
        <div>VisPackStream</div>
        <div>
            <a href="index.html">首页</a>
            <a href="config.html" class="active">配置</a>
            <a href="/logout">退出</a>

        </div>
    </div>
    <div class="container">
        <form id="config-form">
            <div class="card">
                <h2>HttpServer</h2>
                <label>监听端口:
                    <input type="number" name="port" required />
                </label>
                <label>监听路径:
                    <input type="text" name="path" required />
                </label>
            </div>
            <div class="card">
                <h2>HttpClient</h2>
                <label>推送地址:
                    <input type="text" name="targetUrl" required />
                </label>
                <label>孪生体ID:
                    <input type="text" name="twinID" required />
                </label>

            </div>
            <div class="card">
                <h2>用户管理</h2>
                <label>用户名:
                    <input type="text" name="username" required />
                </label>
                <label>密码:
                    <input type="password" name="password" required />
                </label>
                <button type="submit">设置</button>
            </div>
        </form>
        <div id="status"></div>
    </div>

    <script>
        fetch("/get-config")
            .then(res => res.json())
            .then(config => {
                const form = document.forms["config-form"];
                form.port.value = config.port;
                form.path.value = config.path;
                form.targetUrl.value = config.targetUrl;
                form.twinID.value = config.twinID;
                form.username.value = config.username;
                form.password.value = config.password;

            });

        document.getElementById("config-form").addEventListener("submit", e => {
            e.preventDefault();
            const formData = new FormData(e.target);
            fetch("/update-config-restart", {
                method: "POST",
                body: new URLSearchParams(formData)
            })
                .then(res => res.text())
                .then(msg => {
                    document.getElementById("status").textContent = "✅ 配置已更新并重启服务";

                });
        });
    </script>
</body>
</html>